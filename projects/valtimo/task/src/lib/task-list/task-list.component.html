<!--
  ~ Copyright 2015-2023 Ritense BV, the Netherlands.
  ~
  ~ Licensed under EUPL, Version 1.2 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" basis,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<div class="main-content">
  <div class="container-fluid">
    <ng-container *ngTemplateOutlet="tabsTemplate"></ng-container>
    <ng-container *ngTemplateOutlet="listTemplate"></ng-container>
    <valtimo-task-detail-modal
      #taskDetail
      (formSubmit)="getTasks(currentTaskType)"
      (assignmentOfTaskChanged)="getTasks(currentTaskType)"
    ></valtimo-task-detail-modal>
  </div>
</div>

<ng-template #tabsTemplate>
  <cds-tabs
    *ngIf="visibleTabs === null; else configuredTabsTemplate"
    type="contained"
    data-carbon-theme="g10"
    class="task-list-tabs"
  >
    <cds-tab
      *ngFor="let defaultTab of DEFAULT_TABS"
      [active]="activeTab() === defaultTab"
      [heading]="'task-list.' + defaultTab + '.title' | translate"
      [id]="defaultTab"
      (selected)="tabChange(defaultTab)"
    ></cds-tab>
  </cds-tabs>
</ng-template>

<ng-template #configuredTabsTemplate>
  <cds-tabs type="contained" data-carbon-theme="g10" class="task-list-tabs">
    <cds-tab
      *ngFor="let tab of visibleTabs"
      [active]="activeTab() === tab"
      [heading]="'task-list.' + (tab | lowercase) + '.title' | translate"
      [id]="tab"
      (selected)="tabChange(tab)"
    ></cds-tab>
  </cds-tabs>
</ng-template>

<!--[items]="tasks[currentTaskType].tasks"-->
<!--[fields]="tasks[currentTaskType].fields"-->
<!--[pagination]="tasks[currentTaskType].pagination"-->
<!--[viewMode]="true"-->
<!--(paginationClicked)="paginationClicked($event, currentTaskType)"-->
<!--(paginationSet)="paginationSet()"-->
<!--paginationIdentifier="taskList"-->
<!--[isSearchable]="true"-->
<!--[header]="true"-->
<!--(rowClicked)="rowOpenTaskClick($event)"-->
<!--(sortChanged)="sortChanged($event)"-->
<!--[lastColumnTemplate]="caseLink"-->

<ng-template #listTemplate>
  <valtimo-carbon-table
    [data]="tasks[currentTaskType].tasks"
    [tableConfig]="TABLE_CONFIG"
    [fields]="tasks[currentTaskType].fields"
    hideTableHeader
    [pagination]="tasks[currentTaskType].pagination"
    (paginationChange)="paginationClicked($event)"
    (pageSizeSet)="paginationSet()"
    (rowClick)="rowOpenTaskClick($event)"
    (sortChange)="sortChanged($event)"
  >
    <valtimo-no-results
      [action]="dossierListActions"
      description="{{ 'dossier.noResults.description' | translate }}"
      title="{{ 'dossier.noResults.title' | translate }}"
    ></valtimo-no-results>
  </valtimo-carbon-table>
</ng-template>

<ng-template #configuredTabs>
  <ul ngbNav [destroyOnHide]="false" (navChange)="tabChange($event)" class="nav-tabs">
    <li
      *ngFor="let tab of visibleTabs"
      [ngbNavItem]="tab"
      [title]="'task-list.' + tab + '.title' | translate"
    >
      <a ngbNavLink>{{ 'task-list.' + tab + '.title' | translate }}</a>
    </li>
  </ul>
</ng-template>

<ng-template #caseLink let-index="index">
  <a cdsLink href="javascript:void(0)" (click)="openRelatedCase($event, index)">
    {{ 'task-list.goToCase' | translate }}
  </a>
</ng-template>
